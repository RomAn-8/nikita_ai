# nikita_ai - Telegram бот с RAG и MCP интеграцией

## О проекте

**nikita_ai** — это Telegram бот на Python, который предоставляет интеллектуального ассистента с поддержкой:

- **RAG (Retrieval Augmented Generation)** — система поиска по документации проекта с использованием эмбеддингов
- **MCP (Model Context Protocol)** — интеграция с MCP сервером для получения дополнительной информации (git ветки, погода, новости и т.д.)
- **Множество режимов работы** — text, JSON, summary, thinking, expert group и другие
- **Управление памятью** — сохранение истории диалогов в базе данных
- **Гибкая настройка** — управление температурой, моделями, памятью

Бот использует OpenRouter API для работы с различными LLM моделями и может индексировать документацию проекта для ответов на вопросы о структуре и функциональности.

## Запуск

### 1) В IDE (где пишешь код)
Запуск:
```powershell
uv sync
uv run python -m bot.main
```

### 2) Терминал (где реально запускается)
А **выполняешь** эти команды в терминале:

```powershell
cd D:\MyWork\MyRepositories\nikita_ai
uv sync
uv run python -m bot.main
```

**Примечание**: Перед запуском убедитесь, что в корне проекта создан файл `.env` с необходимыми переменными окружения:
- `TELEGRAM_BOT_TOKEN` — токен Telegram бота
- `OPENROUTER_API_KEY` — ключ API для OpenRouter
- `OPENROUTER_MODEL` — модель LLM (по умолчанию: `openai/gpt-4o-mini`)

## RAG система

Бот поддерживает систему RAG (Retrieval Augmented Generation) для работы с документацией проекта.

### Индексация документов

#### Индексация одного файла

Команда `/embed_create` позволяет индексировать отдельный `.md` файл:

1. Вызовите `/embed_create`
2. Отправьте `.md` файл (например, `README.md`)
3. Бот создаст эмбеддинги и сохранит их в базу данных

#### Индексация папки docs/

Команда `/embed_docs` автоматически индексирует все `.md` файлы из папки `docs/`:

1. Вызовите `/embed_docs`
2. Бот найдет все `.md` файлы в папке `docs/` рекурсивно
3. Создаст эмбеддинги для каждого файла и сохранит в базу данных

**Рекомендуемый порядок индексации:**
1. `/embed_create` → отправить `README.md`
2. `/embed_docs` → автоматически проиндексировать все файлы из `docs/`

В папке `docs/` находятся:
- `code-style.md` - правила стиля кода
- `code-examples.md` - примеры кода
- `architecture.md` - архитектура проекта

### Поиск по документации

Команда `/rag_model` активирует режим RAG с тремя подрежимами:

- **RAG+фильтр** (по умолчанию) - поиск с порогом похожести, возвращает только релевантные фрагменты
- **RAG без фильтра** - поиск без порога, возвращает все найденные фрагменты
- **Без RAG** - обычный ответ без поиска по документации

Использование:
```
/rag_model
RAG+фильтр Как работает система эмбеддингов?
```

### Команда /help

Команда `/help` использует RAG для ответов на вопросы о структуре проекта:

- `/help` - показать список всех команд
- `/help <вопрос>` - ответить на вопрос о проекте используя проиндексированную документацию

Примеры:
```
/help Как работает RAG система?
/help Какая структура проекта?
/help Где находится конфигурация?
```

Команда автоматически:
- Ищет релевантные фрагменты в проиндексированной документации
- Формирует ответ на основе найденной информации
- Опционально добавляет информацию о текущей ветке git (если MCP сервер доступен)

## MCP интеграция

Бот интегрирован с MCP (Model Context Protocol) сервером для получения дополнительной информации о проекте.

### Подключение к MCP серверу

Бот подключается к MCP серверу по адресу `http://127.0.0.1:8000/mcp` (streamable HTTP).

Убедитесь, что MCP сервер запущен перед использованием функций, требующих MCP.

### Доступные MCP инструменты

- **git_branch** - получение текущей ветки git-репозитория (используется в команде `/help`)
- **get_weather** - получение погоды для города
- **get_news** - получение новостей по теме
- **site_up**, **site_down**, **site_screenshot** - управление Docker контейнерами

### Настройка MCP сервера

MCP сервер должен быть запущен отдельно. Для python-sdk сервера:

```powershell
cd D:\MyWork\MyRepositories\python-sdk
uv run mcp-server-demo/mcpserver_quickstart.py
```

Сервер будет доступен по адресу `http://127.0.0.1:8000/mcp`.